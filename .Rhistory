Winner == "Blue" ~ 0,
TRUE ~ .5
)) %>%
count(Winner)
r_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 1,
Winner == "Blue" ~ 0,
TRUE ~ .5
))
b_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 0,
Winner == "Blue" ~ 1,
TRUE ~ .5
))
)
rbind(
r_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 1,
Winner == "Blue" ~ 0,
TRUE ~ .5
)),
b_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 0,
Winner == "Blue" ~ 1,
TRUE ~ .5
))
)
rbind(
r_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 1,
Winner == "Blue" ~ 0,
TRUE ~ .5
)),
b_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 0,
Winner == "Blue" ~ 1,
TRUE ~ .5
))
) %>%
left_join(shared_features, by = "match_id")
tidy_df <- rbind(
r_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 1,
Winner == "Blue" ~ 0,
TRUE ~ .5
)),
b_df %>%
mutate(Winner = case_when(
Winner == "Red" ~ 0,
Winner == "Blue" ~ 1,
TRUE ~ .5
))
) %>%
left_join(shared_features, by = "match_id")
tidy_df %>% colnames()
tidy_rf
tidy_df
df
tidy_df
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date)
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id")
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y")
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent)
df %>% dim()
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent) %>%
arrange(match_id)
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent) %>%
group_by(match_id) %>%
slice(1)
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent) %>%
group_by(match_id) %>%
slice(1) %>%
ungroup() %>%
dim()
tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent) %>%
group_by(match_id) %>%
slice(1) %>%
ungroup()
elo_df <- tidy_df %>%
select(fighter, Winner, match_id, weight_class, date) %>%
left_join(tidy_df %>%
select(fighter, match_id),
by = "match_id") %>%
rename("fighter" = "fighter.x",
"opponent" = "fighter.y") %>%
filter(fighter != opponent) %>%
group_by(match_id) %>%
slice(1) %>%
ungroup()
library(elo)
library(broom)
elo.run(Winner~fighter + opponent,
k = 20,
data = elo_df)
elo <- elo.run(Winner~fighter + opponent,
k = 20,
data = elo_df)
rank.teams(elo)
rank.teams(elo) %>%
tidy()
rank.teams(elo) %>%
tidy() %>%
rename("ranking" = "x")
rank.teams(elo) %>%
tidy() %>%
rename("ranking" = "x") %>%
arrange(ranking)
elo_df
elo_top <- function(data){
results <- elo.run(Winner~fighter + opponent,
k = 20,
data = elo_df)
rank.teams(results) %>%
tidy() %>%
rename("ranking" = "x") %>%
filter(ranking <= 10)
}
elo_df
elo_df %>%
group_by(weight_class)
elo_df %>%
group_by(weight_class) %>%
nest()
elo_top <- function(data){
results <- elo.run(Winner~fighter + opponent,
k = 20,
data = elo_df)
rank.teams(results) %>%
tidy() %>%
rename("ranking" = "x") %>%
filter(ranking <= 10)
}
elo_df %>%
group_by(weight_class) %>%
nest()
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top))
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
unnest()
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top))
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top))
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking)
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking) %>%
unnest()
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking) %>%
unnest() %>%
str()
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking) %>%
unnest() %>%
ungroup()
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking) %>%
unnest() %>%
ungroup() %>%
arrange(ranking, weight_class)
elo_top <- function(data){
results <- elo.run(Winner~fighter + opponent,
k = 20,
data = data)
rank.teams(results) %>%
tidy() %>%
rename("ranking" = "x") %>%
filter(ranking <= 10)
}
elo_df %>%
group_by(weight_class) %>%
nest() %>%
mutate(ranking = map(data, elo_top)) %>%
select(weight_class, ranking) %>%
unnest() %>%
ungroup() %>%
arrange(ranking, weight_class)
k_sens <- function(k){
elo <- elo.run(Winner~fighter + opponent,
k = k,
data = elo_df)
rank.teams(elo) %>%
tidy() %>%
rename("ranking" = "x") %>%
filter(ranking <= 10)
}
k_rankings <- tibble(k = seq(from = 1, to = 101, by = 10))
k_ranking
k_rankings
k_rankings %>%
mutate(ranking = map(k, k_sens))
k_rankings %>%
mutate(ranking = map(k, k_sens)) %>%
unnest()
k_rankings <- k_rankings %>%
mutate(ranking = map(k, k_sens)) %>%
unnest()
k_rankings
k_rankings %>%
ggplot(aes(x = names, y = k, fill = ranking)) + geom_tile() + coord_flip()
k_rankings %>%
group_by(names) %>%
mutate(avg_rank = mean(ranking)) %>%
ungroup() %>%
ggplot(aes(x = reorder(names, avg_rank), y = k, fill = ranking)) + geom_tile() + coord_flip()
k_rankings %>%
group_by(names) %>%
mutate(avg_rank = mean(ranking)) %>%
ungroup() %>%
ggplot(aes(x = reorder(names, -avg_rank), y = k, fill = ranking)) + geom_tile() + coord_flip()
elo
elo %>%
tidy()
elo %>%
as.data.frame()
elo %>%
as.data.frame() %>%
rename("fighter" = 1, "opponent" = 2, "fighter_prob" = 3, "fighter_wins"  4, "fighter_elo_change" = 5, "opponent_elo_change" = 6, "fighter_elo" = 7, "opponent_elo" = 8)
elo %>%
as.data.frame() %>%
rename("fighter" = 1, "opponent" = 2, "fighter_prob" = 3, "fighter_wins" = 4, "fighter_elo_change" = 5, "opponent_elo_change" = 6, "fighter_elo" = 7, "opponent_elo" = 8)
elo_history <- function(data){
results <- elo.run(Winner~fighter + opponent,
k = 60,
data = data)
results %>%
as.data.frame() %>%
rename("fighter" = 1, "opponent" = 2, "fighter_prob" = 3, "fighter_wins" = 4, "fighter_elo_change" = 5, "opponent_elo_change" = 6, "fighter_elo" = 7, "opponent_elo" = 8)
}
elo_df
elo %>% as.data.frame()
elo
elo_df
elo_df %>%
arrange(weight_class, fighter)
elo_df %>%
arrange(weight_class, fighter) %>%
group_by(weight_class) %>%
nest()
elo_df %>%
arrange(weight_class, fighter) %>%
group_by(weight_class) %>%
nest() %>%
mutate(history = map(data, elo_history))
elo_df %>%
arrange(weight_class, fighter) %>%
group_by(weight_class) %>%
nest() %>%
mutate(history = map(data, elo_history)) %>%
select(weight_class, history) %>%
unnest() %>%
ungroup()
elo_df %>%
arrange(weight_class, fighter) %>%
group_by(weight_class) %>%
nest() %>%
mutate(history = map(data, elo_history)) %>%
select(weight_class, history) %>%
unnest() %>%
ungroup() %>%
cbind(
elo_df %>%
arrange(weight_class, fighter) %>%
select(match_id)
)
elo_changes <- elo_df %>%
arrange(weight_class, fighter) %>%
group_by(weight_class) %>%
nest() %>%
mutate(history = map(data, elo_history)) %>%
select(weight_class, history) %>%
unnest() %>%
ungroup() %>%
cbind(
elo_df %>%
arrange(weight_class, fighter) %>%
select(match_id)
)
elo_changes
elo_changes
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id)
elo_changes %>% select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id)
elo_changes %>% select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo opponent_elo, match_id)
elo_changes %>% select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo, opponent_elo, match_id)
elo_changes %>% select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id)
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob)
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
rbind(
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id),
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
)
tidy_df
rbind(
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id),
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter = as.character(fighter),
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
) %>%
left_join(tidy_df, by = c("match_id", "fighter"))
rbind(
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id),
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter = as.character(fighter),
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
) %>%
left_join(tidy_df, by = c("match_id", "fighter")) %>%
colnames()
rbind(
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id),
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter = as.character(fighter),
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
) %>%
left_join(tidy_df, by = c("match_id", "fighter")) %>%
select(-weight_class.y) %>%
rename("weight_class" = "weight_class.x") %>%
colnames()
elo_changes <- rbind(
elo_changes %>%
select(weight_class, fighter, fighter_prob, fighter_wins, fighter_elo_change, fighter_elo, match_id),
elo_changes %>%
select(weight_class, fighter = opponent, fighter_prob, fighter_wins, fighter_elo_change = opponent_elo_change, fighter_elo =  opponent_elo, match_id) %>%
mutate(fighter_prob = 1-fighter_prob,
fighter = as.character(fighter),
fighter_wins = case_when(
fighter_wins == 1 ~ 0,
fighter_wins == 0 ~ 1,
TRUE ~ .5
))
) %>%
left_join(tidy_df, by = c("match_id", "fighter")) %>%
select(-weight_class.y) %>%
rename("weight_class" = "weight_class.x")
elo_changes
elo_changes %>%
filter(fighter == "Henry Cejudo")
elo_changes %>%
filter(fighter == "Henry Cejudo") %>%
ggplot(aes(x = date, y = fighter_elo)) + geom_line()
elo_changes %>%
filter(fighter == "Henry Cejudo") %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = fighter_elo)) + geom_line()
elo_changes %>%
filter(fighter == "Henry Cejudo") %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = fighter_elo)) + geom_line() + geom_point()
elo_changes
elo_changes %>%
top_n(fighter_elo, n = 5)
elo_changes %>%
group_by(fighter) %>%
top_n(fighter_elo, n = 1) %>%
ungroup() %>%
top_n(fighter_elo, n = 5)
elo
predict(elo,
data.frame(fighter = "Henry Cejudo",
opponent = "Dominick Cruz"))
predict(elo,
data.frame(fighter = "Jon Jones",
opponent = "Georges St-Pierre"))
elo_changes
elo_changes %>%
top_n(abs(fighter_elo_change))
elo_changes %>%
top_n(abs(fighter_elo_change)) %>%
arrange(abs(fighter_elo_change))
elo_changes %>%
top_n(abs(fighter_elo_change), n = 5) %>%
arrange(abs(fighter_elo_change))
elo_changes
elo_changes %>%
group_by(match_id) %>%
slice(1) %>%
ungroup() %>%
top_n(abs(fighter_elo_change), n = 5)
elo_changes %>%
group_by(match_id) %>%
slice(1) %>%
ungroup() %>%
top_n(abs(fighter_elo_change), n = 5) %>%
arrange(desc(fighter_elo_change))
elo_changes %>%
group_by(match_id) %>%
slice(1) %>%
ungroup() %>%
top_n(abs(fighter_elo_change), n = 5) %>%
arrange(desc(fighter_elo_change)) %>%
select(match_id) %>%
left_join(elo_df)
