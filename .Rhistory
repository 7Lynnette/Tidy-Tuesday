arrange(home) %>%
unique() %>%
ungroup() %>%
mutate(average = mean(rival_attendance)) %>%
ggplot(aes(x = home, y= away, fill = rival_attendance)) +
geom_tile() +
scale_x_discrete(position = "top") +
theme(axis.text.x = element_text(angle = 45, hjust = -.1),
legend.position = "top",
legend.key.width = 5) +
scale_fill_gradient2(midpoint = 67574, high = "blue", low = "red")
knitr::opts_chunk$set(echo = TRUE)
#Who are each team's biggest rivals?  (This is the the team with the most average attendance vs a team)
attendance %>%
select(-team) %>%
mutate(week = as.character(week)) %>%
left_join(games %>% select(year, week, home_team_name, away_team_name), by = c("team_name" = "home_team_name", "year" = "year", "week" = "week")) %>%
drop_na() %>%
select(home = team_name, away = away_team_name, year, week, weekly_attendance) %>%
group_by(home) %>%
mutate(average_attendance = mean(weekly_attendance)) %>%
group_by(home, away) %>%
mutate(rival_attendance = mean(weekly_attendance)) %>%
select(home, away, average_attendance, rival_attendance) %>%
arrange(home) %>%
unique() %>%
ungroup() %>%
mutate(average = mean(rival_attendance)) %>%
ggplot(aes(x = home, y= away, fill = rival_attendance)) +
geom_tile() +
scale_x_discrete(position = "top") +
theme(axis.text.x = element_text(angle = 45, hjust = -.1),
legend.position = "top") +
scale_fill_gradient2(midpoint = 67574, high = "blue", low = "red")
#Who are each team's biggest rivals?  (This is the the team with the most average attendance vs a team)
attendance %>%
select(-team) %>%
mutate(week = as.character(week)) %>%
left_join(games %>% select(year, week, home_team_name, away_team_name), by = c("team_name" = "home_team_name", "year" = "year", "week" = "week")) %>%
drop_na() %>%
select(home = team_name, away = away_team_name, year, week, weekly_attendance) %>%
group_by(home) %>%
mutate(average_attendance = mean(weekly_attendance)) %>%
group_by(home, away) %>%
mutate(rival_attendance = mean(weekly_attendance)) %>%
select(home, away, average_attendance, rival_attendance) %>%
arrange(home) %>%
unique() %>%
ungroup() %>%
mutate(average = mean(rival_attendance)) %>%
ggplot(aes(x = home, y= away, fill = rival_attendance)) +
geom_tile() +
scale_x_discrete(position = "top") +
theme(axis.text.x = element_text(angle = 45, hjust = -.1),
legend.position = "top",
legend.key.width = unit(3, "cm")) +
scale_fill_gradient2(midpoint = 67574, high = "blue", low = "red")
#Who are each team's biggest rivals?  (This is the the team with the most average attendance vs a team)
attendance %>%
select(-team) %>%
mutate(week = as.character(week)) %>%
left_join(games %>% select(year, week, home_team_name, away_team_name), by = c("team_name" = "home_team_name", "year" = "year", "week" = "week")) %>%
drop_na() %>%
select(home = team_name, away = away_team_name, year, week, weekly_attendance) %>%
group_by(home) %>%
mutate(average_attendance = mean(weekly_attendance)) %>%
group_by(home, away) %>%
mutate(rival_attendance = mean(weekly_attendance)) %>%
select(home, away, average_attendance, rival_attendance) %>%
arrange(home) %>%
unique() %>%
ungroup() %>%
mutate(average = mean(rival_attendance)) %>%
ggplot(aes(x = home, y= away, fill = rival_attendance)) +
geom_tile() +
scale_x_discrete(position = "top") +
theme(axis.text.x = element_text(angle = 45, hjust = -.1),
legend.position = "top",
legend.key.width = unit(3, "cm")) +
scale_fill_gradient2(midpoint = 67574, high = "blue", low = "red")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
tuition_cost <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_cost.csv')
tuition_income <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_income.csv')
salary_potential <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/salary_potential.csv')
historical_tuition <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/historical_tuition.csv')
diversity_school <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/diversity_school.csv')
historical_tuition
historical_tuition %>% ggplot(aes(x = year, y= tuition_cost)) + geom_smooth() + geom_point()
historical_tuition
historical_tuition %>% ggplot(aes(x = year, y = tuition_cost, color = type)) + geom_smooth() + geom_point()
historical_tuition
historical_tuition %>% ggplot(aes(x = year, y = tuition_cost, color = tuition_type)) + geom_smooth() + geom_point()
historical_tuition %>% ggplot(aes(x = year, y = tuition_cost, color = tuition_type, group = tuition_type)) + geom_smooth() + geom_point()
historical_tuition
historical_tuition %>% ggplot(aes(x = year, y = tuition_cost, color = tuition_type, group = type)) + geom_smooth() + geom_point()
historical_tuition %>% ggplot(aes(x = year, y = tuition_cost, color = type, group = type)) + geom_smooth() + geom_point()
historical_tuition
historical_tuition %>%
group_by(type) %>%
summarise(min = min(tuition_cost),
max = max(tuitino_cost))
historical_tuition %>%
group_by(type) %>%
summarise(min = min(tuition_cost),
max = max(tuition_cost))
historical_tuition %>%
group_by(type) %>%
summarise(min = min(tuition_cost),
max = max(tuition_cost)) %>%
ungroup() %>%
mutate(range = max - min)
tuition_cost
tuition_income
salary_potential
tuition_income
tuition_cost
salary_potential
tuition_cost %>% left_join(salary_potential, by = "name")
tuition_cost %>% left_join(salary_potential, by = "name") %>% drop_na()
college_df <- tuition_cost %>% left_join(salary_potential, by = "name") %>% drop_na()
college_df
college_df %>%
select(state, -name, -state_code, -type, -degree_length)
college_df %>%
select(state, -name, -state_code, -type, -degree_length, everything())
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length)
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length) %>%
gather(key = "key", value = "value", -state)
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value))
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value))
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value))
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value))
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value))
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(state, key) %>%
top_n(median, n = 5)
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(key) %>%
top_n(median, n = 5)
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(key) %>%
top_n(median, n = 5) %>%
ggplot(aes(x = state, y = median)) + geom_col() + facet_wrap(~key, scales = "free")
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(key) %>%
top_n(median, n = 5) %>%
ggplot(aes(x = state, y = median, fill = state)) + geom_col() + facet_wrap(~key, scales = "free")
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(key) %>%
top_n(median, n = 5) %>%
ggplot(aes(x = state, y = median, fill = state)) + geom_col() + coord_flip() + facet_wrap(~key, scales = "free")
college_df %>%
select(everything(), -name, -state_code, -type, -degree_length, -state_name, -rank) %>%
gather(key = "key", value = "value", -state) %>%
group_by(state, key) %>%
mutate(value = as.numeric(value)) %>%
summarise(min = min(value),
median = median(value),
average = mean(value),
max = max(value)) %>%
group_by(key) %>%
top_n(median, n = 5) %>%
ggplot(aes(x = state, y = median, fill = state)) +
geom_col() +
coord_flip() +
facet_wrap(~key, scales = "free") +
theme(legend.position = "none")
college_df
college_df %>%
select(in_state_tuition, out_of_state_total, early_career_pay, mid_career_pay)
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_tuition, -out_of_state_total)
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total)
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value)
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2)) + geom_point() + facet_wrap(~key + key2, scales = "free")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2)) +
geom_point() +
geom_smooth(se = FALSE) +
facet_wrap(~key + key2, scales = "free")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2)) +
geom_point() +
geom_smooth(se = FALSE) +
facet_wrap(~key + key2, scales = "fixed")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2)) +
geom_point() +
geom_smooth(se = FALSE) +
facet_wrap(~key, scales = "fixed")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2, color = key)) +
geom_point() +
geom_smooth(se = FALSE) +
facet_wrap(~key2, scales = "fixed")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>%
gather(key = "key", value = "value", -in_state_total, -out_of_state_total) %>%
gather(key = "key2", value = "value2", -key, -value) %>%
ggplot(aes(x = value, y = value2, color = key)) +
geom_point() +
facet_wrap(~key2, scales = "fixed")
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay)
college_df %>%
select(in_state_total, out_of_state_total, early_career_pay, mid_career_pay) %>% summary()
college_df
college_df %>% select(-in_state_tuition, -out_of_state_tuition)
college_df %>% select(-in_state_tuition, -out_of_state_tuition, -state_name)
college_df %>%
filter(degree_length == "4 Year") %>%
select(-in_state_tuition, -out_of_state_tuition, -state_name)
college_df %>%
filter(degree_length == "4 Year") %>%
select(-in_state_tuition, -out_of_state_tuition, -state_name, -degree_length)
college_df %>%
filter(degree_length == "4 Year") %>%
select(-in_state_tuition, -out_of_state_tuition, -state_name, -degree_length, -room_and_board)
college_df %>%
filter(degree_length == "4 Year") %>%
select(-in_state_tuition, -out_of_state_tuition, -state_name, -degree_length, -room_and_board, -state)
model_data <- college_df %>%
filter(degree_length == "4 Year") %>%
select(-in_state_tuition, -out_of_state_tuition, -state_name, -degree_length, -room_and_board, -state)
model_data
model_data %>%
ggplot(aes(x = in_state_total, y = out_of_state_total)) + geom_point()
model_data
model_data %>%
mutate(tuition_total = (in_state_total + out_of_state_total) /2)
model_data %>%
mutate(tuition_total = (in_state_total + out_of_state_total) /2) %>%
select(-in_state_total, -out_of_state_total)
model_data %>%
mutate(tuition_total = (in_state_total + out_of_state_total) /2) %>%
select(-in_state_total, -out_of_state_total, -rank)
model_data <- model_data %>%
mutate(tuition_total = (in_state_total + out_of_state_total) /2) %>%
select(-in_state_total, -out_of_state_total, -rank)
model_data
model_data %>%
select_if(is.numeric)
model_data %>%
select_if(is.numeric) %>%
cor()
model_data
model_data <- model_data %>%
select(-stem_percent)
model_data
library(broom)
model_data
library(caret)
model_data
trainIndex <- createDataPartition(model_data$tuition_total, p = .8, list = FALSE)
trainIndex
train_data <- model_data[trainIndex,]
test_data <- model_data[-trainIndex,]
train_data
test_data
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent, data = train_data)
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent, data = train_data) %>%
tidy()
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data) %>%
tidy()
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data)
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data) %>% plot()
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data) %>% summary()
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data) %>%
predict(test_data)
lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data)
baseLine_model <- lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = train_data)
predict(baseLine_model, test_data)
baseLine_model
baseLine_model %>% tidy()
baseLine_model <- lm(tuition_total~state_code + type + early_career_pay  + mid_career_pay + make_world_better_percent + state_code*type, data = model_data)
baseLine_model
baseLine_model %>% augment()
baseLine_model %>% augment() %>% cbind(model_data %>% select(name))
model_data
baseLine_model %>% augment() %>% cbind(model_data %>% select(name))
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, tuition_total, .fitted)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay)
mutate(discount = .pred - acutal)
mutate(discount = predicted - acutal)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - acutal)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
top_n(discoutn, n = 10)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
top_n(discount, n = 10)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
top_n(discount, n = 10) %>%
arrange(desc(discount))
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
top_n(discount, n = 25) %>%
arrange(desc(discount))
baseLine_model %>%
augment()
baseLine_model %>%
augment() %>%
ggplot(aes(x = .fitted, y = tuition_total)) + geom_point()
baseLine_model %>%
augment()
baseLine_model %>%
augment() %>%
ggplot(aes(x = .fitted, y = tuition_total)) +
geom_point()
baseLine_model %>%
augment() %>%
ggplot(aes(x = .fitted, y = tuition_total)) +
geom_point() +
geom_line(fortify(baseLine_model))
baseLine_model %>%
augment() %>%
ggplot(aes(x = .fitted, y = tuition_total)) +
geom_point()
baseLine_model %>%
augment() %>%
ggplot(aes(x = .fitted, y = tuition_total)) +
geom_point() + geom_smooth(se = FALSE, method = "lm")
baseLine_model %>%
augment() %>%
ggplot(aes(y = .fitted, x = tuition_total)) +
geom_point() +
geom_smooth(se = FALSE, method = "lm")
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
ggplot(aes(x = actual, y = predicted, color = discount)) + geom_point()
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
ggplot(aes(x = actual, y = discount)) + geom_point()
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual)
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
filter(name == "University of Iowa")
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
filter(name == "Iowa State University")
baseLine_model %>%
augment() %>%
cbind(model_data %>% select(name)) %>%
select(name, actual =tuition_total, predicted = .fitted, mid_career_pay, early_career_pay) %>%
mutate(discount = predicted - actual) %>%
filter(name == "University of Iowa")
