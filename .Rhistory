df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
gather() %>%
drop_na() %>%
ggplot(aes(x = value, color = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
gather() %>%
drop_na() %>%
ggplot(aes(x = value, fill = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
titanic_rec %>% step_modeimpute(c(Parents.Children.Aboard, Siblings.Spouses.Aboard))
titanic_rec %>% step_modeimpute(Parents.Children.Aboard, Siblings.Spouses.Aboard)
#Add modal imputation for parent and sibling aboard
titanic_rec <- titanic_rec %>% step_modeimpute(Parents.Children.Aboard, Siblings.Spouses.Aboard)
titanic_rec
df %>% summary()
df %>% ggplot(aes(x = Fare)) + geom_density()
df %>% ggplot(aes(x = Fare)) + geom_density() + scale_x_log10()
df %>% ggplot(aes(x = Fare, color = Pclass)) + geom_density() + scale_x_log10()
df
df %>% ggplot(aes(x = Fare, color = Pclass)) + geom_density() + scale_x_log10()
df %>% ggplot(aes(x = Fare, fill = Pclass)) + geom_density() + scale_x_log10()
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare, fill = Pclass)) + geom_density() + scale_x_log10()
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare, fill = Pclass)) + geom_density(alpha = .01) + scale_x_log10()
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare, fill = Pclass)) + geom_density(alpha = .1) + scale_x_log10()
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare)) + geom_density(alpha = .1) + scale_x_log10()
titanic_rec <- titanic_rec %>%
step_medianimpute(Fare)
titanic_rec
#Impute using median instead of average
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare)) + geom_density(alpha = .1) + scale_x_log10()
#Impute using median instead of average
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare)) + geom_density(alpha = .1)
#Impute using median instead of average
df %>%
mutate(Pclass = as.factor(Pclass)) %>%
ggplot(aes(x = Fare)) + geom_density(alpha = .1) + scale_x_log10()
df
titanic_rec
df
df %>% summary()
titanic_rec %>%
step_BoxCox(Age, Siblings.Sposes.Aboard, Parents.Children.Aboard, Fare)
titanic_rec %>%
step_BoxCox(Age, Siblings.Spouses.Aboard, Parents.Children.Aboard, Fare)
#Since none of our values go below 0, we can use the box-cox transformation, otherwise we could use center, scale, and/or yeo-johnson
df %>% summary()
titanic_rec <- titanic_rec %>%
step_BoxCox(Age, Siblings.Spouses.Aboard, Parents.Children.Aboard, Fare)
#Apply dummy variables
df
#Apply dummy variables
titanic_rec
df
#Apply dummy variables
titanic_rec %>%
step_dummy(Sex)
#Apply dummy variables
titanic_rec <- titanic_rec %>%
step_dummy(Sex)
#Impute Pclass using K-nn
titanic_rec <- recipe(Survived ~ Pclass + Sex + Age + Siblings.Spouses.Aboard + Parents.Chilren.Aboard + Fare., data = df) %>%
step_knnimpute(Pclass)
#Impute Pclass using K-nn
titanic_rec <- recipe(Survived ~ Pclass + Sex + Age + Siblings.Spouses.Aboard + Parents.Children.Aboard + Fare., data = df) %>%
step_knnimpute(Pclass)
#Impute Pclass using K-nn
titanic_rec <- recipe(Survived ~ Pclass + Sex + Age + Siblings.Spouses.Aboard + Parents.Children.Aboard + Fare, data = df) %>%
step_knnimpute(Pclass)
#Age can be safely imputed using the mean
titanic_rec <- titanic_rec %>%
step_meanimpute(Age)
#Add modal imputation for parent and sibling aboard
titanic_rec <- titanic_rec %>% step_modeimpute(Parents.Children.Aboard, Siblings.Spouses.Aboard)
#Add median imputation
titanic_rec <- titanic_rec %>%
step_medianimpute(Fare)
#Finished the imputations and now we start compensating for skewness
titanic_rec
#Add transformations
titanic_rec <- titanic_rec %>%
step_BoxCox(Age, Siblings.Spouses.Aboard, Parents.Children.Aboard, Fare)
#Apply dummy variables
titanic_rec <- titanic_rec %>%
step_dummy(Sex)
titanic_rec
#Apply pre-processing to the data
bake(titanic_rec, df)
#Prep the recipe
titanic_prep <- prep(titanic_rec)
#Prep the recipe
titanic_prep <- prep(titanic_rec)
titanic_rec
#Prep the recipe
titanic_prep <- prep(titanic_rec)
titanic_rec
titanic_rec %>%
prep()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidymodels)
df <- read.csv("titanic.csv")
df
df %>% summary()
df %>% nrow()
df %>% summary()
df %>% mutate(row_num = row_number())
df %>% mutate(row_num = row_number()) %>% gather(-row_num) %>% filter(value %>% is.na())
df %>% mutate(row_num = row_number()) %>% gather(-row_num)
df %>% mutate(row_num = row_number()) %>%
df %>% mutate(row_num = row_number())
library(tidyverse)
df %>% mutate(row_num = row_number())
df %>% mutate(row_num = row_number()) %>% gather(-row_num)
df %>% mutate(row_num = row_number()) %>% gather(-"row_num")
df %>% mutate(row_num = row_number())
df %>% mutate(row_num = row_number()) %>% gather()
df %>% mutate(row_num = row_number()) %>% gather(-row_num)
row_num
df %>% mutate(row_num = row_number()) %>% gather(-row_num)
df %>% mutate(row_num = row_number()) %>% gather(-"row_num")
df %>% mutate(row_num = row_number())
df %>% mutate(row_num = row_number()) %>% gather(-row_num)
df %>% mutate(row_num = row_number())
df %>% mutate(row_key = row_number())
df %>% mutate(row_key = row_number()) %>% gather(-row_key)
df %>% mutate(row_key = row_number()) %>% gather(key = "key", value = "value", -row_key)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidymodels)
df <- read.csv("titanic.csv")
df %>% summary()
?rowwise
df
df %>% mutate(row_key = row_number())
df %>% mutate(row_key = row_number()) %>% gather(key = "key", value = "value", -row_key)
df %>%
mutate(row_key = row_number()) %>%
gather(key = "key", value = "value", -row_key) %>%
filter(value %>% is.na())
df %>%
mutate(row_key = row_number()) %>%
gather(key = "key", value = "value", -row_key) %>%
filter(value %>% is.na()) %>%
count(row_key)
df %>%
mutate(row_key = row_number()) %>%
gather(key = "key", value = "value", -row_key) %>%
filter(value %>% is.na()) %>%
count(row_key, sort = TRUE)
df %>% summary()
df %>% group_by(Pclass) %>%
summarise(count = n(),
avg_age = mean(Age, na.rm = TRUE),
avg_fare = mean(Fare, na.rm = TRUE))
df %>%
filter(Pclass %>% is.na())
#But first we need to clean
df
#But first we need to clean
df %>%
select(-Name)
#But first we need to clean
df %>%
select(-Name) %>%
mutate(Sex = as.factor(Sex),
Survived = as.factor(Survived))
#But first we need to clean
df %>%
select(-Name) %>%
mutate(Sex = as.factor(Sex),
Survived = as.factor(Survived),
Pclass = as.factor(Pclass))
#But first we need to clean
df <- df %>%
select(-Name) %>%
mutate(Sex = as.factor(Sex),
Survived = as.factor(Survived),
Pclass = as.factor(Pclass))
df
titanic_rec <- recipe(Survived ~., data = df)
titanic_rec
titanic_rec %>%
step_knnimpute(Pclass)
titanic_rec <- titanic_rec %>%
step_knnimpute(Pclass)
df %>% summary()
df %>% count(Sex)
df %>% group_by(Sex) %>%
summarise(avg_age = mean(Age),
avg_fare = mean(Fare))
df %>% group_by(Sex) %>%
summarise(avg_age = mean(Age, na.rm = TRUE),
avg_fare = mean(Fare, na.rm = TRUE))
df %>% filter(Sex %>% is.na())
df %>% group_by(Sex) %>%
summarise(avg_age = mean(Age, na.rm = TRUE),
avg_fare = mean(Fare, na.rm = TRUE))
df %>% filter(Sex %>% is.na())
titanic_rec %>%
step_modeimpute(Sex)
titanic_rec <- titanic_rec %>%
step_modeimpute(Sex)
df %>% summary()
df %>%
ggplot(aes(Age)) + geom_density()
titanic_rec <- titanic_rec %>%
step_medianimpute(Age)
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard)
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>% gather()
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>% gather() %>% ggplot(aes(x = value, color = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
summary()
df %>%
select(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
gather() %>%
ggplot(aes(x = value, color = key)) +
geom_histogram() +
facet_wrap(~key, scales = "free")
#Since you cannot have a half a parent or sibling aboard lets impute with mode
titanic_rec %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard)
#Since you cannot have a half a parent or sibling aboard lets impute with mode
titanic_rec <- titanic_rec %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard)
df %>% ggplot(aes(x = Fare)) + geom_density()
df %>% ggplot(aes(x = Fare)) + geom_density() + scale_x_log10()
df %>% ggplot(aes(x = Fare, fill = Pclass)) + geom_density() + scale_x_log10()
df %>% ggplot(aes(x = Fare, color = Pclass)) + geom_density() + scale_x_log10()
df %>% ggplot(aes(x = Fare)) + geom_density() + scale_x_log10()
df %>% select(Fare) %>% summary()
df %>% group_by(Pclass) %>%
summarise(count = n(),
min_fare = min(Fare, na.rm = TRUE),
avg_age = mean(Age, na.rm = TRUE),
avg_fare = mean(Fare, na.rm = TRUE))
df %>% group_by(Pclass) %>%
filter(Fare != 0) %>%
summarise(count = n(),
min_fare = min(Fare, na.rm = TRUE),
avg_age = mean(Age, na.rm = TRUE),
avg_fare = mean(Fare, na.rm = TRUE))
df
df %>% filter(Fare %>% is.na())
df %>% select(Fare) %>% summary()
titanic_rec %>%
step_meanimpute(Fare)
titanic_rec <- titanic_rec %>%
step_meanimpute(Fare)
df %>% summary()
df %>% select_if(!is.facotr)
df %>% select_if(!is.factor)
df %>% select_if(is.factor)
df %>% select_if(vars(is.factor))
df %>% select_at(vars(is.factor))
df %>% select_at(!vars(is.factor))
df %>% select_at(is.factor)
df %>% select_if(is.factor)
df %>% select_if(!is.factor)
df
df %>% select(-Survived, -Pclass, -Sex)
df %>% select(-Survived, -Pclass, -Sex) %>% gather()
df %>% select(-Survived, -Pclass, -Sex) %>% gather() %>%
ggplot(aes(x = value, fill = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
df %>% select_if(negate(is.factor)) %>% gather() %>%
ggplot(aes(x = value, fill = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
df %>% select_if(negate(is.factor)) %>% gather() %>%
ggplot(aes(x = value, fill = key)) + geom_histogram() + facet_wrap(~key, scales = "free") + scale_x_log10()
df %>% select_if(negate(is.factor)) %>% gather() %>%
ggplot(aes(x = value, fill = key)) + geom_histogram() + facet_wrap(~key, scales = "free")
#Finished imputing now lets put in some dummyvars
df
#Finished imputing now lets put in some dummyvars
titanic_rec %>%
step_dummy(Pclass, Sex)
#Finished imputing now lets put in some dummyvars
titanic_rec <- titanic_rec %>%
step_dummy(Pclass, Sex)
titanic_rec %>%
step_normalize(all_numeric)
titanic_rec <- titanic_rec %>%
step_normalize(all_numeric)
titanic_prep <- prep(titanic_rec)
titanic_rec
titanic_prep <- prep(titanic_rec)
titanic_prep <- prep(titanic_rec, training = df)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep()
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep()
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep()
df %>% str()
df %>% mutate(Survived = as.character(Survived))
recipe(Survived ~., data = df %>% mutate(Survived = as.character(Survived))) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep()
?prep
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~ . , data = df) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~ . , data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
df %>% fct_drop()
df
df %>% fct_drop(c("Survived", "Pclass", "Sex"))
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
df %>% levels()
df$Survived %>% levels
df$Sex %>% levels
df$Pclass %>% levels
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
#step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
#step_medianimpute(Age) %>%
#step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
#step_medianimpute(Age) %>%
#step_modeimpute(Sex) %>%
#step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
#step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
#step_medianimpute(Age) %>%
#step_modeimpute(Sex) %>%
#step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
df
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_modeimpute(Siblings.Spouses.Aboard) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
prep(strings_as_factors = FALSE)
df
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_normalize(all_numeric()) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE) %>%
bake(df)
recipe(Survived ~., data = df) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex, Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_knnimpute(Pclass) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
recipe(Survived ~., data = df) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
titanic_rec
recipe(Survived ~., data = df) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age, Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
titanic_prep <- recipe(Survived ~., data = df) %>%
step_meanimpute(Fare) %>%
step_medianimpute(Age, Siblings.Spouses.Aboard, Parents.Children.Aboard) %>%
step_modeimpute(Sex) %>%
step_knnimpute(Pclass) %>%
step_normalize(all_numeric()) %>%
step_dummy(Pclass, Sex) %>%
prep(strings_as_factors = FALSE)
bake(titanic_prep, df)
bake(titanic_prep, df) %>% summary()
processed_df <- bake(titanic_prep, df)
processed_df
processed_df %>% drop_na()
processed_df <- processed_df %>% drop_na()
processed_df
